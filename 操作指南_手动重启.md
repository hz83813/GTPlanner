# 手动重启服务指南

## ⚠️ 重要说明

后台启动可能未成功。请手动执行以下步骤：

---

## 🚀 推荐操作步骤

### 方法1：使用启动脚本（推荐）

#### Windows 命令提示符 (CMD)
1. 打开新的 **CMD** 窗口
2. 切换到项目目录：
   ```cmd
   cd D:\git\GTPlanner
   ```
3. 运行启动脚本：
   ```cmd
   start_with_aliyun.bat
   ```

#### PowerShell
1. 打开新的 **PowerShell** 窗口
2. 切换到项目目录：
   ```powershell
   cd D:\git\GTPlanner
   ```
3. 运行启动脚本：
   ```powershell
   .\start_with_aliyun.ps1
   ```

### 方法2：手动设置并启动

1. **打开新的终端窗口**

2. **切换到项目目录**
   ```powershell
   cd D:\git\GTPlanner
   ```

3. **设置环境变量**
   ```powershell
   $env:LLM_API_KEY="sk-88ed0cac1b698888b5a5b80375db6666"
   $env:LLM_BASE_URL="https://dashscope.aliyuncs.com/compatible-mode/v1"
   $env:LLM_MODEL="qwen-max"
   ```

4. **启动服务**
   ```bash
   python fastapi_main.py
   ```

---

## ✅ 验证启动成功

### 启动日志应该显示
```
✅ LLM 配置检查: {'available': True...
✅ 应用初始化完成
✅ 应用启动成功
```

**关键**：看到 `✅ LLM 配置可用` 就对了！

### 如果不成功
如果还是看到：
```
❌ LLM 配置检查: {'available': False...
⚠️ LLM API Key 未配置...
```

请检查：
1. 是否在**正确的终端**中设置了环境变量
2. 是否在该**同一终端**中启动了服务
3. 环境变量是否正确设置

---

## 🧪 测试步骤

### 1. 等待服务启动
看到 "Application startup complete" 后继续

### 2. 访问前端
打开浏览器：http://localhost:11211/static/test_chat.html

### 3. 发送测试请求
- 输入：**设计一个用户管理系统**
- 点击：**发送请求**
- 等待响应

### 4. 预期结果
- ✅ 收到 `ASSISTANT_MESSAGE_CHUNK` 事件
- ✅ `new_messages_count: > 0` （不再是0！）
- ✅ 看到实际的系统设计
- ✅ 看到详细的规划内容

---

## 🎯 关键要点

### 为什么需要用启动脚本？
1. **环境变量需要在同一进程中** - 服务启动时才能读取
2. **启动脚本确保一致** - 总是在设置环境变量后启动
3. **避免配置丢失** - 防止环境变量在不同终端间丢失

### 成功的标准
- 启动日志显示 ✅ LLM 配置可用
- 前端可以正常访问
- 测试请求返回实际内容
- `new_messages_count: > 0`

---

## 🚀 现在就开始

**执行以下命令之一**：

**CMD**:
```cmd
start_with_aliyun.bat
```

**PowerShell**:
```powershell
.\start_with_aliyun.ps1
```

**然后访问** http://localhost:11211/static/test_chat.html 测试！

**一切准备就绪！** 🎉

