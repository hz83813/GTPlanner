# GTPlanner 详细改进清单

## 📊 改进统计

### 已完成 (3项)
- ✅ 环境配置优化
- ✅ 错误修复 (timestamp)
- ✅ 文档完善

### 高优先级待实施 (5项)
- ⏳ 缺失的API端点实现 (11个端点)
- ⏳ 工具索引降级策略
- ⏳ FastAPI lifespan更新
- ⏳ 依赖冲突解决
- ⏳ Python版本升级

### 中优先级待实施 (15项)
- ⏳ 代码质量提升
- ⏳ 性能优化
- ⏳ 安全性增强
- ⏳ 功能增强 (导出、协作、模板)
- ⏳ 监控和可观测性
- ⏳ 集成增强

---

## 🔗 缺失的API端点详情

### 必须实现的端点 (根据文档)

#### 1. 短期规划API
```
POST /planning/short
```
- 功能: 从自然语言需求生成工作流
- 参数: requirement, previous_flow, language, user_id
- 状态: ❌ 未实现

#### 2. 长期规划API  
```
POST /planning/long
```
- 功能: 生成全面设计文档
- 参数: requirement, previous_flow, design_doc, language, user_id
- 状态: ❌ 未实现

#### 3. 非流式聊天API
```
POST /api/chat
```
- 功能: 同步聊天（非流式）
- 参数: user_input
- 状态: ❌ 未实现

#### 4-7. 会话管理API
```
GET    /api/sessions              # 获取会话列表
GET    /api/sessions/{session_id} # 获取会话详情
DELETE /api/sessions/{session_id} # 删除会话
GET    /api/sessions/{session_id}/stats # 获取统计信息
```
- 状态: ❌ 未实现

#### 8-10. 工具查询API
```
GET  /api/tools           # 获取所有工具
GET  /api/tools/{name}    # 获取工具详情
POST /api/tools/recommend # 工具推荐
```
- 状态: ❌ 未实现

**影响**: 文档与实现严重不一致

---

## 🎯 立即需要修复的问题

### 1. AgentContext 验证错误
**错误**: `AgentContext 验证失败: AgentContext 数据格式错误: 'timestamp'`

**已修复**: ✅ 添加默认timestamp生成

**需要测试**: ⏳ 确认修复生效

### 2. 工具索引初始化失败
**错误**: `应用初始化失败，存在 1 个错误 - 工具索引不可用`

**影响**: 
- 工具推荐功能不可用
- 需要vector service配置
- 初始化可能阻塞

**措施**: ⏳ 添加降级策略

### 3. FastAPI 过时API警告
**警告**: `on_event is deprecated, use lifespan event handlers instead`

**措施**: ⏳ 更新到lifespan API

---

## 📈 功能完整度评估

### 核心功能
- ✅ Agent 核心处理
- ✅ SSE 流式响应
- ✅ Function Calling
- ✅ 多语言支持
- ⚠️ 工具索引（需要配置）

### API功能
- ✅ `/api/chat/agent` (流式)
- ❌ `/planning/short` (缺失)
- ❌ `/planning/long` (缺失)
- ❌ `/api/chat` (非流式，缺失)
- ❌ 会话管理API (缺失)
- ❌ 工具查询API (缺失)
- ⚠️ 健康检查 (基础实现)

### 文档功能
- ⚠️ Markdown 导出 (基础)
- ❌ PDF 导出
- ❌ Word 导出
- ❌ 批量导出

### 协作功能
- ❌ 共享PRD
- ❌ 评论系统
- ❌ 协作编辑
- ❌ 权限管理

### 集成功能
- ❌ CI/CD 集成
- ❌ Git 仓库分析
- ❌ Issue管理集成

---

## 🎯 实施路线图

### 第一阶段 (本周)
1. ✅ 环境配置优化
2. ✅ 错误修复
3. ⏳ 实现 `/planning/short` API
4. ⏳ 实现 `/planning/long` API
5. ⏳ 添加工具索引降级策略

### 第二阶段 (下周)
1. ⏳ 实现会话管理API
2. ⏳ 实现工具查询API
3. ⏳ 更新 FastAPI lifespan
4. ⏳ 解决依赖冲突
5. ⏳ 添加错误处理

### 第三阶段 (两周后)
1. ⏳ 添加导出功能
2. ⏳ 实现批量处理
3. ⏳ 添加监控
4. ⏳ 安全性增强

### 第四阶段 (一月后)
1. ⏳ 协作功能
2. ⏳ 模板系统
3. ⏳ CI/CD集成
4. ⏳ 代码仓库集成

---

## 📝 关键发现

### 文档与实现不一致

| 文档中描述 | 实际实现 | 状态 |
|------------|----------|------|
| `POST /planning/short` | ❌ 不存在 | 缺失 |
| `POST /planning/long` | ❌ 不存在 | 缺失 |
| `POST /api/chat` | ❌ 不存在 | 缺失 |
| 会话管理API | ❌ 不存在 | 缺失 |
| 工具查询API | ❌ 不存在 | 缺失 |

**影响**: 用户根据README使用API会遇到404错误

### 架构设计 vs 实际功能

**文档描述的架构**:
- 多个专门的API端点
- 清晰的职责分离
- 完整的RESTful设计

**实际实现**:
- 只有一个流式端点
- 功能集中在一个端点
- 缺少功能分离

**建议**: 重构API架构，实现文档中描述的设计

---

## ✅ 总结

**已完成的改进**: 3项
**高优先级待实施**: 5项  
**中优先级待实施**: 15项
**总改进项**: 23项

**核心问题**: 文档与实现不一致，缺失多个重要API端点

**建议**: 优先实现文档中描述但未实现的API端点，这是最重要的改进。

