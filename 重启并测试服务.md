# 重启服务并测试

## ✅ 环境变量已设置

确认环境变量：
```
LLM_API_KEY: sk-88ed0cac1b698888b5a5b80375db6666 ✅
LLM_BASE_URL: https://dashscope.aliyuncs.com/compatible-mode/v1 ✅
LLM_MODEL: qwen-max ✅
```

---

## 🔄 重启服务步骤

### 1. 停止当前服务

在运行 `python fastapi_main.py` 的终端中：
1. 按 **Ctrl+C** 停止服务
2. 等待服务完全关闭

### 2. 重新启动服务

在同一个终端中运行：

```bash
python fastapi_main.py
```

### 3. 验证新配置

启动时应该看到：
```
✅ LLM 配置可用
✅ 应用初始化完成  
✅ 应用启动成功
```

**不再看到**：
```
❌ LLM 配置检查: {'available': False...
⚠️ LLM API Key 未配置...
```

---

## 🧪 测试步骤

### 1. 检查服务健康状态
访问：http://localhost:11211/health

应该返回：
```json
{
  "status": "healthy",
  "service": "gtplanner"
}
```

### 2. 打开前端页面
访问：http://localhost:11211/static/test_chat.html

### 3. 发送测试请求
1. 输入：**设计一个用户管理系统**
2. 点击：**发送请求**
3. 等待响应

### 4. 预期结果

**成功标志**：
- ✅ 收到 `CONNECTION` 事件
- ✅ 收到 `CONVERSATION_START` 事件
- ✅ 收到 `ASSISTANT_MESSAGE_CHUNK` 事件（**关键！有新内容**）
- ✅ `new_messages_count: > 0` （**不再是0**）
- ✅ 看到完整的系统设计
- ✅ 看到详细的规划流程

**失败标志**（如果配置无效）：
- ❌ `new_messages_count: 0`
- ❌ 没有 ASSISTANT_MESSAGE_CHUNK
- ❌ 只有心跳，没有内容

---

## 📋 检查清单

### 重启前
- [ ] 环境变量已设置
- [ ] 停止当前服务
- [ ] 准备重启

### 重启后
- [ ] 服务启动成功
- [ ] 启动日志显示 ✅ LLM 配置可用
- [ ] 健康检查通过
- [ ] 前端可以访问
- [ ] 测试请求返回实际内容

---

## 🎯 成功标志

如果一切正常，你应该看到：

### 启动日志
```
✅ LLM 配置检查: {'available': True...}
✅ 应用初始化完成
✅ 应用启动成功
```

### 前端响应
```
ASSISTANT_MESSAGE_CHUNK: 正在分析您的需求...
ASSISTANT_MESSAGE_CHUNK: 生成系统架构...
ASSISTANT_MESSAGE_CHUNK: 设计数据库结构...
...
new_messages_count: 15 ✅
```

---

## 💡 如果还是看不到内容

### 可能原因1：环境变量未应用到服务
**解决**：确保在启动服务的终端中环境变量已设置

### 可能原因2：API Key无效
**检查**：
- 验证 API Key 是否正确
- 检查是否有余额
- 确认模型名称正确（qwen-max）

### 可能原因3：网络问题
**检查**：
- 是否能访问阿里云服务
- 防火墙是否阻止

---

## 🎉 准备就绪

**配置已完成，现在请**：
1. 按 Ctrl+C 停止服务
2. 运行 `python fastapi_main.py` 重启
3. 测试前端功能

**配置已完成，准备测试！** 🚀

