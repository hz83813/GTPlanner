# 阿里云百炼配置和测试指南

## ✅ 配置已完成

### 环境变量设置成功
```powershell
LLM_API_KEY = sk-88ed0cac1b698888b5a5b80375db6666
LLM_BASE_URL = https://dashscope.aliyuncs.com/compatible-mode/v1
LLM_MODEL = qwen-max
```

### 验证结果
环境检查通过：
```
[OK] LLM_API_KEY: sk-44ed0ca...
[OK] LLM_BASE_URL: https://da...
[OK] LLM_MODEL: qwen-max
```

---

## 🚀 重启服务并测试

### 重要：需要重启服务

**当前状态**：
- 服务正在运行（旧配置）
- 需要重启以应用新配置

### 重启步骤

#### 方法1：手动重启
1. 在运行服务的终端中按 **Ctrl+C** 停止服务
2. 重新启动：
   ```bash
   python fastapi_main.py
   ```

#### 方法2：自动重启（使用配置脚本）
```powershell
# 在新终端中执行
.\setup_aliyun_config.ps1
python fastapi_main.py
```

---

## 📝 预期启动日志

配置成功后，启动时应该看到：

```
✅ LLM 配置可用
✅ 应用初始化完成
✅ 应用启动成功
```

**不再是**：
```
❌ LLM 配置检查: {'available': False...
⚠️ LLM API Key 未配置...
```

---

## 🎯 测试步骤

### 1. 确认服务使用新配置
访问：http://localhost:11211/health

应该看到健康状态正常

### 2. 打开前端页面
访问：http://localhost:11211/static/test_chat.html

### 3. 测试功能
1. 在输入框输入：**设计一个用户管理系统**
2. 点击"发送请求"
3. **现在应该能看到实际的PRD内容！** ✅

### 4. 预期效果
**之前（未配置LLM）**：
- ❌ `new_messages_count: 0`
- ❌ 没有实际内容

**现在（已配置LLM）**：
- ✅ `new_messages_count: > 0`
- ✅ 有完整的PRD生成
- ✅ 有详细的系统设计
- ✅ 有规划流程

---

## 🔧 如果服务仍在运行

### 检查旧服务
如果服务还在用旧环境变量运行：

1. **停止旧服务**
   - 找到运行服务的终端
   - 按 Ctrl+C 停止

2. **重新启动**
   ```bash
   python fastapi_main.py
   ```

3. **验证配置**
   - 查看启动日志是否有 ✅ LLM 配置可用

---

## ✅ 验证清单

完成以下检查：

- [ ] 环境变量已设置
- [ ] 环境检查通过
- [ ] 服务已重启
- [ ] 启动日志显示 ✅ LLM 配置可用
- [ ] 前端可以访问
- [ ] 测试请求返回实际内容

---

## 🎉 测试准备完成

**配置已成功设置！**

现在请：
1. 重启服务（应用新配置）
2. 测试前端功能
3. 享受智能规划功能！

**所有准备工作已完成！** 🚀

